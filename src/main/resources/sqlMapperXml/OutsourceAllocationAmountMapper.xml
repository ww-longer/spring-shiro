<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.main.mapper.OutsourceAllocationAmountMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.main.model.OutsourceAllocationAmount">
        <id column="id" property="id"/>
        <result column="name" property="name"/>
        <result column="cust_id" property="custId"/>
        <result column="tel_number" property="telNumber"/>
        <result column="ious" property="ious"/>
        <result column="now_collection_amount" property="nowCollectionAmount"/>
        <result column="now_agecd" property="nowAgecd"/>
        <result column="transfer_agecd" property="transferAgecd"/>
        <result column="transfer" property="transfer"/>
        <result column="the_push_day" property="thePushDay"/>
        <result column="last_collection_amount" property="lastCollectionAmount"/>
        <result column="last_agecd" property="lastAgecd"/>
        <result column="update_time" property="updateTime"/>
        <result column="company" property="company"/>
        <result column="remarks" property="remarks"/>
        <result column="creat_date" property="creatDate"/>
        <result column="is_leave_case" property="isLeaveCase"/>
        <result column="leave_case_date" property="leaveCaseDate"/>
        <result column="transfer_amount" property="transferAmount"/>
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
		id, name, cust_id AS custId, tel_number AS telNumber, ious, now_collection_amount AS nowCollectionAmount,
		now_agecd AS nowAgecd, transfer_agecd AS transferAgecd, transfer, the_push_day AS thePushDay,
		last_collection_amount AS lastCollectionAmount, last_agecd AS lastAgecd, update_time AS updateTime,
		company, remarks, creat_date AS creatDate, is_leave_case AS isLeaveCase, leave_case_date AS leaveCaseDate,
		transfer_amount AS transferAmount
	</sql>

    <!-- 分页查询 -->
    <select id="selectPageInfo" resultType="Map">
        SELECT
        <include refid="Base_Column_List"/>
        FROM OUTSOURCE_ALLOCATION_AMOUNT
        <where>
            1=1
            <if test="name != null and name != ''">
                AND `NAME` LIKE #{name}
            </if>
            <if test="custId != null and custId != ''">
                AND CUST_ID = #{custId}
            </if>
            <if test="ious != null and ious != ''">
                AND IOUS = #{ious}
            </if>
            <if test="company != null and company != ''">
                AND COMPANY = #{company}
            </if>
            <if test="startTransferTime != null and startTransferTime != ''">
                AND TRANSFER >= #{startTransferTime}
            </if>
            <if test="endTransfertTime != null and endTransfertTime != ''">
                AND TRANSFER &lt;= #{endTransfertTime}
            </if>
            <if test="startThePushDayTime != null and startThePushDayTime != ''">
                AND THE_PUSH_DAY >= #{startThePushDayTime}
            </if>
            <if test="endThePushDayTime != null and endThePushDayTime != ''">
                AND THE_PUSH_DAY &lt;= #{endThePushDayTime}
            </if>
        </where>
    </select>

    <!-- 查询满足条件的所有数据 -->
    <select id="loadOutsourceAmountByMaps" resultType="com.main.model.OutsourceAllocationAmount">
        SELECT
        <include refid="Base_Column_List"/>
        FROM OUTSOURCE_ALLOCATION_AMOUNT
        <where>
            1=1
            <if test="custId != null and custId != ''">
                AND CUST_ID = #{custId}
            </if>
            <if test="ious != null and ious != ''">
                AND IOUS = #{ious}
            </if>
            <if test="company != null and company != ''">
                AND COMPANY = #{company}
            </if>
            <if test="nowCollectionAmount != null">
                AND NOW_COLLECTION_AMOUNT > #{nowCollectionAmount}
            </if>
            <if test="transfer != null and transfer != ''">
                AND TRANSFER = #{transfer}
            </if>
        </where>
        <if test="isNotList != null and isNotList != ''">
            LIMIT 1
        </if>
    </select>

    <!-- 删除所有满足条件的数据 -->
    <delete id="deleteOutsourceAmountOverdue">
        DELETE FROM OUTSOURCE_ALLOCATION_AMOUNT
        <where>
            1=1
            <if test="thePushDay != null and thePushDay != ''">
                AND THE_PUSH_DAY &lt;= #{thePushDay}
            </if>
        </where>
    </delete>

    <!-- 公共查询所有满足条件的所有数据 -->
    <select id="loadCommonAmountByMaps" resultType="com.main.model.OutsourceAllocationAmount">
        SELECT
        <include refid="Base_Column_List"/>
        FROM OUTSOURCE_ALLOCATION_AMOUNT
        <where>
            1=1
            <if test="id != null">
                AND ID = #{id}
            </if>
            <if test="custId != null and custId != ''">
                AND CUST_ID = #{custId}
            </if>
            <if test="ious != null and ious != ''">
                AND IOUS = #{ious}
            </if>
            <if test="company != null and company != ''">
                AND COMPANY = #{company}
            </if>
            <if test="nowCollectionAmountgt != null">
                AND NOW_COLLECTION_AMOUNT > #{nowCollectionAmountgt}
            </if>
            <if test="nowCollectionAmountlt != null">
                AND NOW_COLLECTION_AMOUNT &lt; #{nowCollectionAmountlt}
            </if>
            <if test="transfereq != null and transfereq != ''">
                AND TRANSFER = #{transfereq}
            </if>
            <if test="startTransferTime != null and startTransferTime != ''">
                AND TRANSFER >= #{startTransferTime}
            </if>
            <if test="endTransfertTime != null and endTransfertTime != ''">
                AND TRANSFER &lt;= #{endTransfertTime}
            </if>
            <if test="startThePushDayTime != null and startThePushDayTime != ''">
                AND THE_PUSH_DAY >= #{startThePushDayTime}
            </if>
            <if test="endThePushDayTime != null and endThePushDayTime != ''">
                AND THE_PUSH_DAY &lt;= #{endThePushDayTime}
            </if>
        </where>
        <if test="orderStr != null and orderStr != ''">
            ORDER BY ${orderStr} ${orderAsc}
        </if>
        <if test="isNotList != null and isNotList != ''">
            LIMIT 1
        </if>
    </select>
    <!-- 根据ID查询 -->
    <select id="selectById" resultType="com.main.model.OutsourceAllocationAmount">
        SELECT
        <include refid="Base_Column_List"/>
        FROM OUTSOURCE_ALLOCATION_AMOUNT WHERE ID = #{id}
    </select>
<<<<<<< HEAD

    <!-- 查询当前所有再催移交日期 -->
    <select id="selectAllTransfer" resultType="java.lang.String">
        SELECT DATE_FORMAT(r.TRANSFER, '%Y%m%d') AS transfer FROM
        OUTSOURCE_ALLOCATION_AMOUNT r
        <where>
            1=1
            <if test="company != null and company != ''">
                AND COMPANY = #{company}
            </if>
        </where>
        GROUP BY r.TRANSFER
    </select>

=======

    <!-- 查询当前所有再催移交日期 -->
    <select id="selectAllTransfer" resultType="java.lang.String">
        SELECT DATE_FORMAT(r.TRANSFER, '%Y%m%d') AS transfer FROM
        OUTSOURCE_ALLOCATION_AMOUNT r
        <where>
            1=1
            <if test="company != null and company != ''">
                AND COMPANY = #{company}
            </if>
        </where>
        GROUP BY r.TRANSFER
    </select>

>>>>>>> 820b10959a43b0fbc60804f4f0f01cc98886e790
    <!-- 插入数据并返回ID -->
    <insert id="insertInfo" parameterType="com.main.model.OutsourceAllocationAmount" useGeneratedKeys="true"
            keyProperty="id">
        insert into
        OUTSOURCE_ALLOCATION_AMOUNT
        (
         id, name, cust_id, tel_number, ious, now_collection_amount, now_agecd, transfer_agecd,
         transfer, the_push_day, last_collection_amount, last_agecd, update_time, company, remarks,
         creat_date, is_leave_case, leave_case_date, transfer_amount
        )
        values
        (
         #{id,jdbcType=INTEGER},
         #{name,jdbcType=VARCHAR},
         #{custId,jdbcType=VARCHAR},
         #{telNumber,jdbcType=VARCHAR},
         #{ious,jdbcType=VARCHAR},
         #{nowCollectionAmount,jdbcType=DOUBLE},
         #{nowAgecd,jdbcType=INTEGER},
         #{transferAgecd,jdbcType=INTEGER},
         #{transfer,jdbcType=TIMESTAMP},
         #{thePushDay,jdbcType=TIMESTAMP},
         #{lastCollectionAmount,jdbcType=DOUBLE},
         #{lastAgecd,jdbcType=INTEGER},
         #{updateTime,jdbcType=TIMESTAMP},
         #{company,jdbcType=VARCHAR},
         #{remarks,jdbcType=VARCHAR},
         #{creatDate,jdbcType=TIMESTAMP},
         #{isLeaveCase,jdbcType=VARCHAR},
		 #{leaveCaseDate,jdbcType=TIMESTAMP},
		 #{transferAmount,jdbcType=DOUBLE}
        )
    </insert>
    <!-- 饼图-公司账龄-总数 -->
    <select id="searchAllCompanyCaseNum" resultType="Map">
        SELECT COMPANY AS company, COUNT(1) count, SUM(now_collection_amount) as sum FROM `OUTSOURCE_ALLOCATION_AMOUNT`
        WHERE 1=1 AND NOW_AGECD &lt;&gt; 0 GROUP BY COMPANY
    </select>
    <!-- 饼图-公司账龄-总金额 -->
    <select id="searchAllCaseAgecdNum" resultType="Map">
        SELECT COMPANY AS company, NOW_AGECD as agecd, COUNT(1) count, SUM(now_collection_amount) as sum FROM `OUTSOURCE_ALLOCATION_AMOUNT`
        WHERE 1=1 AND NOW_AGECD &lt;&gt; 0 GROUP BY COMPANY, NOW_AGECD
    </select>

    <!-- 饼图-账龄公司-总数 -->
    <select id="searchAllAgecdCompanyCase" resultType="Map">
        SELECT  NOW_AGECD as agecd, COUNT(1) count, SUM(now_collection_amount) as sum FROM `OUTSOURCE_ALLOCATION_AMOUNT`
        WHERE 1=1 AND NOW_AGECD &lt;&gt; 0 GROUP BY NOW_AGECD
    </select>
    <!-- 饼图-账龄公司-总金额 -->
    <select id="searchAllAgecdCompanyAmount" resultType="Map">
        SELECT COMPANY AS company, NOW_AGECD as agecd, COUNT(1) count, SUM(now_collection_amount) as sum FROM `OUTSOURCE_ALLOCATION_AMOUNT`
        WHERE 1=1 AND NOW_AGECD &lt;&gt; 0 GROUP BY NOW_AGECD, COMPANY
    </select>

    <select id="searchAllCompanyCaseNum" resultType="Map">
        SELECT company, COUNT(1) count FROM `outsource_allocation_amount` GROUP BY company
    </select>

</mapper>
